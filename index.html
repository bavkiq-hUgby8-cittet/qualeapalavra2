<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Qual Ã© a Palavra? - CÃ¢mera e Confetes! (Eye and Rotating Clock) [Fixed]</title>
  <!-- Tailwind CSS via CDN para estilo -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Pequeno script de confetes -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <style>
    /*
      TEST CASES:
      1) Minimum 4 players => else alert.
      2) Eye icon => big closed eye.
      3) Timer => an analog clock with rotating pointer when time is running.
      4) Code has only one 'let primeiraTentativa = true;' => no duplicate variable.
      5) Photo upload => displayed.
      6) Confetti for winners.
    */

    .hover-scale:hover {
      transform: scale(1.2);
      transition: transform 0.2s;
      cursor: pointer;
    }

    /* Timer color transition (green -> red) handled in script. */

    /* Eye closed icon (inline SVG) */
    #eyeIcon svg {
      width: 32px;
      height: 32px;
      fill: currentColor;
    }

    /* Clock pointer spinning animation */
    .spin {
      animation: spin 1s linear infinite;
      transform-origin: center center;
    }
    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }
  </style>
</head>
<body class="w-screen min-h-screen bg-gradient-to-br from-gray-100 to-blue-100 p-2 md:p-6 overflow-x-hidden">

<div id="app" class="flex flex-col justify-center items-center w-full max-w-[1920px] mx-auto relative">
  <!-- Canvas para confetes -->
  <canvas id="confettiCanvas" class="pointer-events-none fixed top-0 left-0 w-full h-full z-50"></canvas>

  <!-- MODAL DE REGRAS DO JOGO -->
  <div id="modalRegras" class="fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 items-center justify-center hidden z-40">
    <div class="bg-white p-6 rounded-xl shadow-2xl max-w-lg mx-auto">
      <h2 class="text-2xl font-bold mb-4">Regras do Jogo</h2>
      <p class="mb-4">
        1) VocÃª deve formar duplas de jogadores.<br/>
        2) Em cada palavra, a dupla que iniciar tem chance de ganhar 2 pontos se acertar de primeira.<br/>
        3) Se errar, as outras duplas ou a mesma dupla em nova vez ganham apenas 1 ponto se acertarem.<br/>
        4) Se pular ou o tempo acabar, passa para a prÃ³xima dupla ou prÃ³xima palavra.<br/>
        5) Ao final, a dupla com mais pontos vence.<br/>
      </p>
      <!-- BotÃ£o de fala -->
      <button id="btnFalarRegras" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded font-semibold shadow-lg mb-4">
        Falar Regras
      </button>
      <button id="btnFecharModal" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded font-semibold shadow-lg">Fechar</button>
    </div>
  </div>

  <!-- TELA DE CONFIGURAÃ‡ÃƒO INICIAL -->
  <div id="config-screen" class="w-full max-w-4xl p-4 md:p-6 shadow-2xl bg-gradient-to-r from-white to-gray-50 rounded-2xl mb-4">
    <h1 class="text-3xl font-extrabold mb-6 text-center">ConfiguraÃ§Ã£o Inicial</h1>

    <div class="flex flex-col md:flex-row justify-between mb-4 items-center gap-4">
      <!-- SeleÃ§Ã£o de idioma via Ã­cones -->
      <div>
        <label class="block mb-2 font-semibold">Escolha o idioma:</label>
        <div id="idiomaEscolha" class="flex gap-4 flex-wrap">
          <label class="flex items-center gap-2 cursor-pointer">
            <input type="radio" name="idiomaRadio" value="PT-BR" checked>
            <span class="text-2xl">ðŸ‡§ðŸ‡·</span>
          </label>
          <label class="flex items-center gap-2 cursor-pointer">
            <input type="radio" name="idiomaRadio" value="PT-PT">
            <span class="text-2xl">ðŸ‡µðŸ‡¹</span>
          </label>
          <label class="flex items-center gap-2 cursor-pointer">
            <input type="radio" name="idiomaRadio" value="EN-US">
            <span class="text-2xl">ðŸ‡ºðŸ‡¸</span>
          </label>
          <label class="flex items-center gap-2 cursor-pointer">
            <input type="radio" name="idiomaRadio" value="ES">
            <span class="text-2xl">ðŸ‡ªðŸ‡¸</span>
          </label>
        </div>
      </div>
      <!-- BotÃ£o ver regras -->
      <button id="btnRegras" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded font-bold shadow-lg">
        Regras?
      </button>
    </div>

    <div class="mb-4">
      <label class="block mb-1 font-semibold">Tempo MÃ¡ximo (segundos):</label>
      <input type="number" id="tempoMaximo" min="5" value="60" class="w-full border border-gray-300 p-3 rounded" />
    </div>

    <div class="mb-4">
      <label class="block mb-1 font-semibold">Jogadores:</label>
      <div class="flex gap-2 mb-2 flex-wrap">
        <input type="text" id="nomeJogador" class="border border-gray-300 p-3 rounded w-full md:w-1/2" placeholder="Nome do Jogador"/>
        <!-- Input de foto c/ capture p/ mobile -->
        <input type="file" id="fotoJogador" accept="image/*" capture="user" class="border border-gray-300 p-3 rounded w-full md:w-1/2 bg-white"/>
      </div>
      <div class="flex justify-end">
        <button id="btnAdicionarJogador" class="bg-blue-500 hover:bg-blue-600 text-white px-5 py-2 rounded font-bold shadow-lg">Adicionar</button>
      </div>

      <div id="listaJogadores" class="bg-blue-50 border border-blue-200 p-3 rounded h-32 overflow-y-auto mt-2">
        <!-- Lista de jogadores adicionados -->
      </div>
    </div>

    <div class="mb-4">
      <label class="block mb-1 font-semibold">FormaÃ§Ã£o das Duplas:</label>
      <select id="modoDuplas" class="w-full border border-gray-300 p-3 rounded">
        <option value="aleatorio">AleatÃ³rio</option>
        <option value="manual">Manual (Sequencial)</option>
      </select>
    </div>

    <button id="btnIniciar" class="bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded w-full font-bold text-lg shadow-lg">Iniciar</button>
  </div>

  <!-- TELA PRINCIPAL DE JOGO -->
  <div id="main-screen" class="w-full max-w-5xl p-2 md:p-4 hidden">
    <div class="flex flex-col md:flex-row justify-between items-center mb-4 gap-4">
      <button id="btnEncerrar" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded font-semibold shadow">Encerrar Partida</button>
      <div id="boxPontuacao" class="bg-gradient-to-r from-blue-50 to-white p-4 rounded-xl shadow-md text-sm w-full md:w-96">
        <h2 class="text-lg font-bold mb-3 text-center">PontuaÃ§Ã£o</h2>
        <div id="scoreContainer" class="flex flex-col gap-2">
          <!-- Preenchido dinamicamente -->
        </div>
      </div>
    </div>

    <div class="mb-4 p-4 bg-gradient-to-br from-blue-50 to-white rounded-2xl shadow-2xl">
      <h2 class="text-xl font-semibold mb-3">Dupla Atual</h2>
      <div class="flex items-center gap-2 mb-2">
        <!-- Foto do jogador de dica -->
        <img id="doadorFoto" src="" alt="Foto do Doador" class="w-12 h-12 object-cover rounded-full hidden"/>
        <p class="text-lg font-bold text-blue-700">JOGADOR DE DICA: <span id="doador" class="bg-white rounded px-2 py-1"></span></p>
      </div>

      <div class="flex items-center gap-2 mb-2">
        <!-- Foto do jogador adivinhador -->
        <img id="adivinhadorFoto" src="" alt="Foto do Adivinhador" class="w-12 h-12 object-cover rounded-full hidden"/>
        <p class="text-lg font-bold text-green-700">ADIVINHADOR: <span id="adivinhador" class="bg-white rounded px-2 py-1"></span></p>
      </div>

      <div class="mt-2 flex items-center gap-2">
        <!-- Ãcone (grande) para mostrar a palavra, substitui "ðŸ”’" por um olho fechado -->
        <input type="checkbox" id="togglePalavra" class="hidden" />
        <label for="togglePalavra" id="labelToggle" class="cursor-pointer bg-gray-300 p-2 rounded shadow flex items-center justify-center">
          <!-- Big eye closed icon (inline SVG) -->
          <span id="eyeIcon" class="text-gray-800">
            <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
              <!-- Eye closed shape -->
              <path d="M2 32c6-14 18-22 30-22s24 8 30 22c-6 14-18 22-30 22S8 46 2 32z" fill="#ccc"/>
              <!-- line across, signifying closed -->
              <path d="M10 10 L54 54" stroke="#444" stroke-width="5"/>
            </svg>
          </span>
        </label>

        <span id="palavraSecreta" class="ml-2 hidden bg-white text-red-500 px-2 py-1 rounded shadow">
          <strong>Palavra Secreta:</strong> <span id="conteudoPalavra"></span>
        </span>
      </div>
    </div>

    <!-- Timer e status -->
    <div class="mb-4 flex items-center gap-4">
      <div class="text-xl font-bold flex gap-2 items-center">
        <span>Tempo Restante:</span>
        <span id="tempoRestante" class="text-green-600 font-extrabold text-2xl">60</span> <span>seg</span>
      </div>
      <button id="btnIniciarTempo"
              class="rounded-full w-16 h-16 bg-green-500 hover:bg-green-600 text-white flex items-center justify-center shadow relative"
              title="Iniciar Tempo">
        <!-- Removemos â², definimos um relÃ³gio de ponteiro animado -->
        <svg id="clockIcon" viewBox="0 0 64 64" width="32" height="32" class="" xmlns="http://www.w3.org/2000/svg">
          <!-- Clock face -->
          <circle cx="32" cy="32" r="28" fill="#fff" stroke="#333" stroke-width="4"/>
          <!-- Clock center -->
          <circle cx="32" cy="32" r="3" fill="#333"/>
          <!-- Hour marks -->
          <line x1="32" y1="4" x2="32" y2="10" stroke="#333" stroke-width="3"/>
          <line x1="32" y1="54" x2="32" y2="60" stroke="#333" stroke-width="3"/>
          <line x1="4" y1="32" x2="10" y2="32" stroke="#333" stroke-width="3"/>
          <line x1="54" y1="32" x2="60" y2="32" stroke="#333" stroke-width="3"/>
          <!-- pointer -->
          <line id="clockHand" x1="32" y1="32" x2="32" y2="12" stroke="#000" stroke-width="3" stroke-linecap="round"/>
        </svg>
      </button>
    </div>

    <div class="mb-4 p-4 bg-gradient-to-br from-blue-50 to-white rounded-2xl shadow-2xl">
      <div class="mb-4">
        <label class="block font-bold mb-2">Dica para o Adivinhador:</label>
        <div class="flex gap-2">
          <input type="text" id="campoDica" class="border border-gray-300 p-2 rounded w-full bg-white" />
          <button id="btnEnviarDica" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded font-semibold shadow">OK</button>
        </div>
      </div>
      <div>
        <label class="block font-bold mb-2">Chute do Adivinhador:</label>
        <div class="flex gap-2">
          <input type="text" id="campoChute" class="border border-gray-300 p-2 rounded w-full bg-white" />
          <button id="btnEnviarChute" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded font-semibold shadow">OK</button>
        </div>
      </div>
    </div>

    <!-- BotÃ£o de Pular sem perder a vez -->
    <div class="mb-4">
      <button id="btnPular" class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded font-semibold shadow">Pular Palavra (mesma dupla)</button>
    </div>

    <div class="bg-gradient-to-br from-blue-50 to-white p-4 rounded-2xl shadow-2xl w-full">
      <h3 class="text-xl font-semibold mb-2">HistÃ³rico</h3>
      <div id="historicoAcoes" class="h-60 overflow-y-auto text-sm border border-gray-300 p-2 rounded bg-white">
        <!-- Registro de aÃ§Ãµes -->
      </div>
    </div>
  </div>

  <!-- TELA FINAL DE PARTIDA -->
  <div id="end-screen" class="w-full max-w-4xl p-6 shadow-2xl bg-gradient-to-r from-white to-gray-50 rounded-2xl text-center mt-8 hidden relative">
    <h1 class="text-2xl font-bold mb-4">Partida Encerrada</h1>
    <p id="resultado" class="text-xl mb-2"></p>
    <div id="pontuacaoFinal" class="mb-4"></div>
    <button id="btnReiniciar" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded font-semibold shadow-lg">Reiniciar</button>
  </div>
</div>

<script>
  // We have only one 'let primeiraTentativa' declared once.
  // Additional test case: #4 => no duplication.

  // Canvas Confetti
  const confettiCanvas = document.getElementById('confettiCanvas');
  const confettiCtx = confettiCanvas.getContext('2d');
  confettiCanvas.width = window.innerWidth;
  confettiCanvas.height = window.innerHeight;

  window.addEventListener('resize', () => {
    confettiCanvas.width = window.innerWidth;
    confettiCanvas.height = window.innerHeight;
  });

  function launchConfetti() {
    const end = Date.now() + 2 * 1000;
    (function frame() {
      confetti({
        particleCount: 5,
        angle: Math.random() * 60 + 100,
        spread: 55,
        origin: { x: Math.random(), y: Math.random() * 0.3 },
        useWorker: true,
      });
      if (Date.now() < end) {
        requestAnimationFrame(frame);
      }
    })();
  }

  const colorPalette = [
    'bg-red-200 text-red-800',
    'bg-green-200 text-green-800',
    'bg-yellow-200 text-yellow-800',
    'bg-purple-200 text-purple-800',
    'bg-pink-200 text-pink-800',
    'bg-orange-200 text-orange-800',
    'bg-blue-200 text-blue-800',
    'bg-teal-200 text-teal-800'
  ];

  const modalRegras = document.getElementById('modalRegras');
  const btnRegras = document.getElementById('btnRegras');
  const btnFecharModal = document.getElementById('btnFecharModal');
  const btnFalarRegras = document.getElementById('btnFalarRegras');

  const configScreen = document.getElementById('config-screen');
  const mainScreen = document.getElementById('main-screen');
  const endScreen = document.getElementById('end-screen');

  const inputTempoMaximo = document.getElementById('tempoMaximo');
  const inputNomeJogador = document.getElementById('nomeJogador');
  const inputFotoJogador = document.getElementById('fotoJogador');
  const listaJogadoresEl = document.getElementById('listaJogadores');
  const modoDuplasSelect = document.getElementById('modoDuplas');

  const btnAdicionarJogador = document.getElementById('btnAdicionarJogador');
  const btnIniciar = document.getElementById('btnIniciar');
  const btnEncerrar = document.getElementById('btnEncerrar');
  const btnIniciarTempo = document.getElementById('btnIniciarTempo');
  const btnEnviarDica = document.getElementById('btnEnviarDica');
  const btnEnviarChute = document.getElementById('btnEnviarChute');
  const btnPular = document.getElementById('btnPular');
  const btnReiniciar = document.getElementById('btnReiniciar');

  const scoreContainer = document.getElementById('scoreContainer');
  const doadorEl = document.getElementById('doador');
  const doadorFoto = document.getElementById('doadorFoto');
  const adivinhadorEl = document.getElementById('adivinhador');
  const adivinhadorFoto = document.getElementById('adivinhadorFoto');
  const palavraSecretaEl = document.getElementById('palavraSecreta');
  const conteudoPalavraEl = document.getElementById('conteudoPalavra');
  const tempoRestanteEl = document.getElementById('tempoRestante');
  const campoDica = document.getElementById('campoDica');
  const campoChute = document.getElementById('campoChute');
  const historicoAcoes = document.getElementById('historicoAcoes');
  const endResultado = document.getElementById('resultado');
  const endPontuacaoFinal = document.getElementById('pontuacaoFinal');
  const togglePalavraCheckbox = document.getElementById('togglePalavra');
  const eyeIcon = document.getElementById('eyeIcon');

  const clockHand = document.getElementById('clockHand');

  let jogadores = [];
  let duplas = [];
  let scores = [];

  let palavrasBanco = {
    'PT-BR': ['cachorro', 'arco-iris', 'vermelho', 'futebol', 'jantar', 'cachorro'],
    'PT-PT': ['cÃ£o', 'arc-Ã­ris', 'vermelho', 'futebol', 'jantar'],
    'EN-US': ['dog', 'rainbow', 'red', 'soccer', 'dinner'],
    'ES': ['perro', 'arcoiris', 'rojo', 'futbol', 'cena']
  };

  let palavrasRodada = [];
  let indicePalavra = 0;
  let duplaAtual = 0;
  // Only declared once
  let primeiraTentativa = true;

  let mostraPalavra = false;
  let tempoMaximoValue = 60;
  let tempoRestante = 60;
  let timerInterval = null;

  let historico = [];

  function getSelectedIdioma() {
    const checked = document.querySelector('input[name=idiomaRadio]:checked');
    return checked ? checked.value : 'PT-BR';
  }

  function exibirTelaConfig() {
    configScreen.classList.remove('hidden');
    mainScreen.classList.add('hidden');
    endScreen.classList.add('hidden');
  }

  function exibirTelaPrincipal() {
    configScreen.classList.add('hidden');
    mainScreen.classList.remove('hidden');
    endScreen.classList.add('hidden');
  }

  function exibirTelaFinal() {
    configScreen.classList.add('hidden');
    mainScreen.classList.add('hidden');
    endScreen.classList.remove('hidden');
  }

  function adicionarJogador() {
    let nomeDigitado = inputNomeJogador.value.trim() || `Convidado #${jogadores.length + 1}`;
    let colorClass = colorPalette[jogadores.length % colorPalette.length];

    let fotoDataUrl = '';
    const file = fotoJogador.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        fotoDataUrl = e.target.result;
        pushJogador(nomeDigitado, colorClass, fotoDataUrl);
      };
      reader.readAsDataURL(file);
    } else {
      pushJogador(nomeDigitado, colorClass, fotoDataUrl);
    }
  }

  function pushJogador(name, colorClass, fotoDataUrl) {
    const newPlayer = {
      name,
      color: colorClass,
      photo: fotoDataUrl,
    };
    jogadores.push(newPlayer);

    nomeJogador.value = '';
    fotoJogador.value = '';
    renderJogadores();
  }

  function renderJogadores() {
    listaJogadoresEl.innerHTML = '';
    jogadores.forEach((player) => {
      const div = document.createElement('div');
      div.className = `${player.color} p-2 uppercase rounded mb-1 shadow-sm font-bold flex items-center gap-2`;

      if (player.photo) {
        const imgEl = document.createElement('img');
        imgEl.src = player.photo;
        imgEl.alt = 'Foto';
        imgEl.className = 'w-8 h-8 object-cover rounded-full';
        div.appendChild(imgEl);
      }

      const spanNome = document.createElement('span');
      spanNome.textContent = player.name;
      div.appendChild(spanNome);

      listaJogadoresEl.appendChild(div);
    });
  }

  function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  function iniciarJogo() {
    if (jogadores.length < 4 || (jogadores.length % 2 !== 0)) {
      alert('Ã‰ necessÃ¡rio ao menos 4 jogadores (nÃºmero par).');
      return;
    }
    duplas = [];
    const modo = modoDuplasSelect.value;

    let arrCopia = [...jogadores];
    if (modo !== 'manual') {
      shuffleArray(arrCopia);
    }

    for (let i = 0; i < arrCopia.length; i += 2) {
      duplas.push([ arrCopia[i], arrCopia[i+1] ]);
    }

    scores = new Array(duplas.length).fill(0);

    const idioma = getSelectedIdioma();
    let listaPalavrasBrutas = Array.from(new Set(palavrasBanco[idioma] || []));
    shuffleArray(listaPalavrasBrutas);

    palavrasRodada = listaPalavrasBrutas.slice(0, 5);
    indicePalavra = 0;
    duplaAtual = 0;
    primeiraTentativa = true;

    tempoMaximoValue = parseInt(tempoMaximo.value) || 60;
    tempoRestante = tempoMaximoValue;
    tempoRestanteEl.textContent = tempoRestante;
    tempoRestanteEl.classList.remove('text-red-600');
    tempoRestanteEl.classList.add('text-green-600');

    mostraPalavra = false;
    togglePalavraCheckbox.checked = false;
    palavraSecretaEl.classList.add('hidden');
    eyeIcon.innerHTML = `<svg viewBox='0 0 64 64'><path d='M2 32c6-14 18-22 30-22s24 8 30 22c-6 14-18 22-30 22S8 46 2 32z' fill='#ccc'/><path d='M10 10 L54 54' stroke='#444' stroke-width='5'/></svg>`;

    historico = [];
    atualizarHistoricoNaTela();

    renderPontuacao();
    atualizarDuplaNaTela();
    exibirTelaPrincipal();
  }

  function atualizarDuplaNaTela() {
    const doadorPlayer = duplas[duplaAtual][0];
    const adivPlayer = duplas[duplaAtual][1];

    doadorEl.textContent = doadorPlayer.name.toUpperCase();
    adivinhadorEl.textContent = adivPlayer.name.toUpperCase();
    conteudoPalavraEl.textContent = palavrasRodada[indicePalavra] || '';

    if (doadorPlayer.photo) {
      doadorFoto.src = doadorPlayer.photo;
      doadorFoto.classList.remove('hidden');
    } else {
      doadorFoto.classList.add('hidden');
    }

    if (adivPlayer.photo) {
      adivinhadorFoto.src = adivPlayer.photo;
      adivinhadorFoto.classList.remove('hidden');
    } else {
      adivinhadorFoto.classList.add('hidden');
    }
  }

  function encerrarPartida() {
    exibirTelaFinal();
    pararTimer();

    let maiorPontuacao = Math.max(...scores);
    let indicesMax = scores.map((val, idx) => val === maiorPontuacao ? idx : -1).filter(i => i >= 0);
    if (indicesMax.length > 1) {
      endResultado.textContent = 'Temos um Empate!';
    } else {
      const campeaoArr = duplas[indicesMax[0]];
      const campeao = campeaoArr[0].name + ' & ' + campeaoArr[1].name;
      endResultado.textContent = 'Dupla Vencedora: ' + campeao;
    }

    endPontuacaoFinal.innerHTML = '<h2 class="font-semibold">PontuaÃ§Ã£o Final</h2>';
    duplas.forEach((dupla, idx) => {
      let nomes = dupla[0].name.toUpperCase() + ' & ' + dupla[1].name.toUpperCase();
      const div = document.createElement('div');
      div.className = 'flex items-center gap-2 my-2';

      dupla.forEach((p) => {
        if (p.photo) {
          const img = document.createElement('img');
          img.src = p.photo;
          img.alt = 'Foto';
          img.className = 'w-8 h-8 object-cover rounded-full';
          div.appendChild(img);
        }
      });

      const txt = document.createElement('span');
      txt.textContent = nomes + ': ' + scores[idx] + ' pts';
      div.appendChild(txt);

      endPontuacaoFinal.appendChild(div);
    });

    indicesMax.forEach(() => {
      launchConfetti();
    });
  }

  function reiniciar() {
    jogadores = [];
    duplas = [];
    scores = [];
    palavrasRodada = [];
    indicePalavra = 0;
    duplaAtual = 0;
    mostraPalavra = false;
    tempoRestante = 60;
    historico = [];
    nomeJogador.value = '';
    fotoJogador.value = '';
    renderJogadores();
    exibirTelaConfig();
  }

  function pararTimer() {
    if (timerInterval) {
      clearInterval(timerInterval);
      timerInterval = null;
    }
    // remove spin from #clockHand
    clockHand.classList.remove('spin');
  }

  function iniciarTimer() {
    pararTimer();
    // add spin class to #clockHand
    clockHand.classList.add('spin');

    timerInterval = setInterval(() => {
      tempoRestante--;
      tempoRestanteEl.textContent = tempoRestante;

      if (tempoRestante <= 10) {
        tempoRestanteEl.classList.remove('text-green-600');
        tempoRestanteEl.classList.add('text-red-600');
      } else {
        tempoRestanteEl.classList.remove('text-red-600');
        tempoRestanteEl.classList.add('text-green-600');
      }

      if (tempoRestante <= 0) {
        pararTimer();
        registrarHistorico('PULOU', 'Tempo esgotado.', getAdivinhadorName());
        passarParaProximaDuplaMesmaPalavra();
      }
    }, 1000);
  }

  function renderPontuacao() {
    scoreContainer.innerHTML = '';
    duplas.forEach((dupla, idx) => {
      let nomes = dupla[0].name.toUpperCase() + ' & ' + dupla[1].name.toUpperCase();
      const row = document.createElement('div');
      row.className = 'p-2 bg-white rounded shadow flex items-center gap-2';

      dupla.forEach((p) => {
        if (p.photo) {
          const img = document.createElement('img');
          img.src = p.photo;
          img.alt = 'Foto';
          img.className = 'w-6 h-6 object-cover rounded-full';
          row.appendChild(img);
        }
      });

      const txt = document.createElement('span');
      txt.className = 'font-bold text-sm';
      txt.textContent = nomes;
      row.appendChild(txt);

      const pts = document.createElement('span');
      pts.className = 'text-blue-700 font-extrabold text-lg ml-auto';
      pts.textContent = `${scores[idx]} pts`;
      row.appendChild(pts);

      scoreContainer.appendChild(row);
    });
  }

  function registrarHistorico(acao, texto, jogador, pontos) {
    const currentWord = palavrasRodada[indicePalavra] || '';
    historico.push({ acao, texto, jogador, points: pontos, palavra: currentWord });
    atualizarHistoricoNaTela();
  }

  function atualizarHistoricoNaTela() {
    historicoAcoes.innerHTML = '';
    historico.forEach((h) => {
      let mensagem = '';
      let icone = '';
      if (h.acao === 'DICA') {
        icone = 'ðŸ’¡';
        mensagem = `${icone} ${h.jogador}: "${h.texto}"`;
      } else if (h.acao === 'ERRO') {
        icone = 'âŒ';
        mensagem = `${icone} ${h.jogador}: "${h.texto}"`;
      } else if (h.acao === 'ACERTO') {
        icone = 'âœ…';
        mensagem = `${icone} ${h.jogador} +${h.points || 0} pts`;
      } else if (h.acao === 'PULOU') {
        icone = 'â­ï¸';
        mensagem = `${icone} ${h.jogador}: ${h.texto}`;
      }

      const secretIcon = document.createElement('span');
      secretIcon.textContent = 'ðŸ”Ž';
      secretIcon.className = 'ml-2 text-blue-700 hover-scale';
      secretIcon.title = 'Ver palavra secreta';
      secretIcon.addEventListener('click', () => {
        alert(`A palavra secreta era: ${h.palavra}`);
      });

      const div = document.createElement('div');
      div.textContent = mensagem;
      div.appendChild(secretIcon);
      historicoAcoes.appendChild(div);
    });
    historicoAcoes.scrollTop = historicoAcoes.scrollHeight;
  }

  function getDoadorName() {
    return duplas[duplaAtual][0].name.toUpperCase();
  }
  function getAdivinhadorName() {
    return duplas[duplaAtual][1].name.toUpperCase();
  }

  function enviarDica() {
    const dica = campoDica.value.trim();
    if (!dica) return;
    registrarHistorico('DICA', dica, getDoadorName());
    campoDica.value = '';
  }

  function enviarChute() {
    const chute = campoChute.value.trim();
    if (!chute) return;
    const palavraAtual = palavrasRodada[indicePalavra];
    if (!palavraAtual) return;

    if (chute.toLowerCase() === palavraAtual.toLowerCase()) {
      const adiv = getAdivinhadorName();
      const pontos = primeiraTentativa ? 2 : 1;
      registrarHistorico('ACERTO', chute, adiv, pontos);
      scores[duplaAtual] += pontos;
      renderPontuacao();
      passarParaProximaPalavra();
    } else {
      registrarHistorico('ERRO', chute, getAdivinhadorName());
      if (primeiraTentativa) {
        primeiraTentativa = false;
      }
      passarParaProximaDuplaMesmaPalavra();
    }
    campoChute.value = '';
  }

  function pularPalavra() {
    registrarHistorico('PULOU', 'Palavra pulada', getAdivinhadorName());
    pararTimer();
    passarParaProximaPalavra();
  }

  function passarParaProximaPalavra() {
    indicePalavra++;
    if (indicePalavra >= palavrasRodada.length) {
      encerrarPartida();
      return;
    }

    duplaAtual = (duplaAtual + 1) % duplas.length;

    tempoRestante = tempoMaximoValue;
    tempoRestanteEl.textContent = tempoRestante;
    primeiraTentativa = true;

    tempoRestanteEl.classList.remove('text-red-600');
    tempoRestanteEl.classList.add('text-green-600');

    mostraPalavra = false;
    togglePalavraCheckbox.checked = false;
    palavraSecretaEl.classList.add('hidden');
    eyeIcon.innerHTML = `<svg viewBox='0 0 64 64'><path d='M2 32c6-14 18-22 30-22s24 8 30 22c-6 14-18 22-30 22S8 46 2 32z' fill='#ccc'/><path d='M10 10 L54 54' stroke='#444' stroke-width='5'/></svg>`;

    atualizarDuplaNaTela();
  }

  function passarParaProximaDuplaMesmaPalavra() {
    pararTimer();
    duplaAtual = (duplaAtual + 1) % duplas.length;

    tempoRestante = tempoMaximoValue;
    tempoRestanteEl.textContent = tempoRestante;
    tempoRestanteEl.classList.remove('text-red-600');
    tempoRestanteEl.classList.add('text-green-600');

    mostraPalavra = false;
    togglePalavraCheckbox.checked = false;
    palavraSecretaEl.classList.add('hidden');
    eyeIcon.innerHTML = `<svg viewBox='0 0 64 64'><path d='M2 32c6-14 18-22 30-22s24 8 30 22c-6 14-18 22-30 22S8 46 2 32z' fill='#ccc'/><path d='M10 10 L54 54' stroke='#444' stroke-width='5'/></svg>`;

    atualizarDuplaNaTela();
  }

  function falarRegras() {
    const msg = new SpeechSynthesisUtterance();
    msg.text = `
      1) VocÃª deve formar duplas de jogadores.
      2) Em cada palavra, a dupla que iniciar tem chance de ganhar 2 pontos se acertar de primeira.
      3) Se errar, as outras duplas ou a mesma dupla em nova vez ganham apenas 1 ponto se acertarem.
      4) Se pular ou o tempo acabar, passa para a prÃ³xima dupla ou prÃ³xima palavra.
      5) Ao final, a dupla com mais pontos vence.
    `;
    msg.lang = 'pt-BR';
    speechSynthesis.speak(msg);
  }

  // EVENT LISTENERS
  btnAdicionarJogador.addEventListener('click', adicionarJogador);
  btnIniciar.addEventListener('click', iniciarJogo);
  btnEncerrar.addEventListener('click', encerrarPartida);
  btnReiniciar.addEventListener('click', reiniciar);

  togglePalavraCheckbox.addEventListener('change', (evt) => {
    if (evt.target.checked) {
      palavraSecretaEl.classList.remove('hidden');
      eyeIcon.innerHTML = `<svg viewBox='0 0 64 64'><path d='M2 32c6-14 18-22 30-22s24 8 30 22c-6 14-18 22-30 22S8 46 2 32z' fill='#ccc'/><!-- no slash, eye open --><circle cx='32' cy='32' r='8' fill='#444'/></svg>`;
      mostraPalavra = true;
    } else {
      palavraSecretaEl.classList.add('hidden');
      eyeIcon.innerHTML = `<svg viewBox='0 0 64 64'><path d='M2 32c6-14 18-22 30-22s24 8 30 22c-6 14-18 22-30 22S8 46 2 32z' fill='#ccc'/><path d='M10 10 L54 54' stroke='#444' stroke-width='5'/></svg>`;
      mostraPalavra = false;
    }
  });

  btnIniciarTempo.addEventListener('click', iniciarTimer);
  btnEnviarDica.addEventListener('click', enviarDica);
  btnEnviarChute.addEventListener('click', enviarChute);
  btnPular.addEventListener('click', pularPalavra);

  btnRegras.addEventListener('click', () => {
    modalRegras.classList.remove('hidden');
    modalRegras.classList.add('flex');
  });
  btnFecharModal.addEventListener('click', () => {
    modalRegras.classList.add('hidden');
    modalRegras.classList.remove('flex');
  });
  btnFalarRegras.addEventListener('click', () => {
    falarRegras();
  });

  // Inicia na tela config
  exibirTelaConfig();
</script>
</body>
</html>
